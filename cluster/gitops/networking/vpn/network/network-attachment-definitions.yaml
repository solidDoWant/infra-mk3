# These NADs are for the VPN gateway network.
---
apiVersion: k8s.cni.cncf.io/v1
kind: NetworkAttachmentDefinition
metadata:
  name: gateway-network-vpn-gateway-pods
spec:
  config: |
    {
      "cniVersion": "0.3.0",
      "name": "gateway-network-vpn-gateway-pods",
      "type": "bridge",
      "bridge": "vpn-gw-bridge0",
      "ipam": {
        "type": "whereabouts",
        "range": "192.168.50.0/24",
        "range_start": "192.168.50.248",
        "range_end": "192.168.50.254"
      },
      "mtu": 1450
    }
---
apiVersion: k8s.cni.cncf.io/v1
kind: NetworkAttachmentDefinition
metadata:
  name: gateway-network-router-pods
spec:
  config: |
    {
      "cniVersion": "0.3.0",
      "name": "gateway-network-router-pods",
      "type": "bridge",
      "bridge": "vpn-gw-bridge0",
      "ipam": {
        "type": "whereabouts",
        "range": "192.168.50.0/24",
        "range_start": "192.168.50.241",
        "range_end": "192.168.50.247"
      },
      "mtu": 1450
    }
---
apiVersion: k8s.cni.cncf.io/v1
kind: NetworkAttachmentDefinition
metadata:
  name: gateway-network-client-pods
spec:
  config: |
    {
      "cniVersion": "0.3.0",
      "name": "gateway-network-client-pods",
      "type": "bridge",
      "bridge": "vpn-gw-bridge0",
      "ipam": {
        "type": "whereabouts",
        "range": "192.168.50.0/24",
        "range_start": "192.168.50.1",
        "range_end": "192.168.50.239",
        "routes": [
          {"dst": "0.0.0.0/5"},
          {"dst": "8.0.0.0/7"},
          {"dst": "11.0.0.0/8"},
          {"dst": "12.0.0.0/6"},
          {"dst": "16.0.0.0/4"},
          {"dst": "32.0.0.0/3"},
          {"dst": "64.0.0.0/2"},
          {"dst": "128.0.0.0/1"}
        ],
        "gateway": "192.168.50.240"
      },
      "mtu": 1450
    }
...
# These NADs are for the router pod network.
# TODO all pods in all namespaces can reference this NAD with how I have multus configured.
# Need to restrict this one to just the router pods.
---
apiVersion: k8s.cni.cncf.io/v1
kind: NetworkAttachmentDefinition
metadata:
  name: vpn-router-network-router-pods
spec:
  config: |
    {
      "cniVersion": "0.3.0",
      "name": "vpn-router-network-router-pods",
      "type": "bridge",
      "bridge": "vpn-r-bridge0",
      "ipam": {
        "type": "whereabouts",
        "range": "192.168.51.0/24",
      },
      "mtu": 1450
    }

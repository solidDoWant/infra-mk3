---
apiVersion: dragonflydb.io/v1alpha1
kind: Dragonfly
metadata:
  name: authentik-dragonfly
spec:
  replicas: 2
  args:
    - --proactor_threads=2 # Dragonfly requires 256MB of RAM per core
  authentication:
    clientCaCertSecret:
      key: ca.crt
      name: authentik-dragonfly-auth-ca-cert
  tlsSecretRef:
    name: authentik-dragonfly-serving-cert
  # TODO
  # topologySpreadConstraints:
  #   - maxSkew:
  #     topologyKey:
  #     whenUnsatisfiable:
  resources:
    requests:
      cpu: 100m
      # Needs (thread_count * 256Mi) / 0.8
      memory: 640Mi
    limits:
      memory: 640Mi

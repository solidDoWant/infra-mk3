---
common:
  vlans:
    "100": &vlan_standard
      name: Management
      mtu: &standard_mtu 1500
      trunked: true
    "200":
      <<: *vlan_standard
      name: Hosts
      mtu: &jumbo_mtu 9000
    "300":
      <<: *vlan_standard
      name: Kubernetes
      mtu: *jumbo_mtu
    "400":
      <<: *vlan_standard
      name: User devices
    "500":
      <<: *vlan_standard
      name: Guest devices
    "600":
      <<: *vlan_standard
      name: IoT devices
devices:
  proxmox-vm-host-01:
    physical:
      enp137s0:
        mtu: *jumbo_mtu
        description: "LAN interface, 56G QSFP+ #1"
      eno1:
        mtu: *standard_mtu
        description: XGS-PON WAN
    bonds:
      bond0:
        slaves:
          - enp137s0
        mtu: *jumbo_mtu
        description: LAN interface bond to switch-01
    _default_vlan_config: &proxmox_vlan_defaults
      raw-device: bond0
      bridge: true
    vlans:
      "100":
        <<: *proxmox_vlan_defaults
      "200":
        <<: *proxmox_vlan_defaults
        local-interface:
          ip-address: 10.2.2.1/16
          gateway: 10.2.0.254
      "300": *proxmox_vlan_defaults
      "400": *proxmox_vlan_defaults
      "500": *proxmox_vlan_defaults
      "600": *proxmox_vlan_defaults
    bridges:
      vmbrWAN:
        raw-device: eno1
        description: WAN to XGS-PON bridge
        mtu: *standard_mtu
        local-interface:
          ip-address: 192.168.11.254/16
  switch-02:
    physical:
      "1/1":
        description: talos-k8s-mixed-01
      "1/2":
        description: talos-k8s-mixed-02
      "1/3":
        description: talos-k8s-mixed-03
      "1/4":
        description: talos-k8s-mixed-04
      "1/5":
        description: proxmox-vm-host-01
      "1/6":
      "1/7":
      "1/8":
      "1/9":
        description: pdu-01
      "1/10":
        description: ups-01
      "1/11":
        description: tape-library-01
      "1/12":
        description: kvm-01
      "1/13":
      "1/14":
      "1/15":
      "1/16":
      "1/17":
      "1/18":
      "1/19":
      "1/20":
      "1/21":
      "1/22":
      "1/23":
      "1/24":
      "2/1":
        description: switch-01 QSFP 1/4/1
      "2/2":
        description: switch-01 QSFP 1/4/2
      "2/3":
        description: switch-01 QSFP 1/4/3
      "2/4":
        description: switch-01 QSFP 1/4/4
      "2/5":
      "2/6":
      "2/7":
      "2/8":
    bonds:
      "100":
        description: switch-01_QSFP_1/4
        slaves:
          - 2/1
          - 2/2
          - 2/3
          - 2/4
    vlans:
      "100":
        tagged_interfaces: &switch_02_trunk
          channel_groups:
            - 100
        untagged_interfaces:
          ethernet:
            - 1/1
            - 1/2
            - 1/3
            - 1/4
            - 1/5
            - 1/6
            - 1/7
            - 1/8
            - 1/9
            - 1/10
            - 1/11
            - 1/12
        management_interface:
          ip_address: 10.1.0.2/24
          gateway: 10.1.0.254
      "200":
        untagged_interfaces:
          ethernet:
            - 1/13
            - 1/14
            - 1/15
            - 1/16
        tagged_interfaces: *switch_02_trunk
      "300":
        tagged_interfaces: *switch_02_trunk
      "400":
        untagged_interfaces:
          ethernet:
            - 1/17
            - 1/18
            - 1/19
            - 1/20
        tagged_interfaces: *switch_02_trunk
      "500":
        tagged_interfaces: *switch_02_trunk
        pvlan:
          type: primary
          trunks: *switch_02_trunk
          secondary_pvlans:
            - "510"
      "510":
        description: Guest devices isolated
        untagged_interfaces:
          ethernet:
            - 1/21
            - 1/22
            - 1/23
            - 1/24
        pvlan:
          type: isolated
        trunked: false
      "600":
        tagged_interfaces: *switch_02_trunk
        pvlan:
          type: primary
          trunks: *switch_02_trunk
          secondary_pvlans:
            - "610"
      "610":
        description: IoT devices isolated
        tagged_interfaces:
          ethernet:
            - 1/21
            - 1/22
            - 1/23
            - 1/24
        trunked: false
        pvlan:
          type: isolated
ip-space:
  10.0.0.0/9:
    description: Private IP space for home infra
    10.0.0.0/11:
      description: Physical devices and virtualized OSs
      10.0.0.0/16:
        reserved: true
      10.1.0.0/16:
        description: Managment
        vlan: 100
        gateway: 10.1.0.254/32
        10.1.0.0/24:
          description: Network devices
          10.1.0.1/32:
            hostname: switch-01
          10.1.0.2/32:
            hostname: switch-02
          10.1.0.254/32:
            description: OPNsense VIP
        10.1.1.0/24:
          description: Kubernetes hosts OOBM
          10.1.1.1/32:
            hostname: talos-k8s-mixed-01
          10.1.1.2/32:
            hostname: talos-k8s-mixed-02
          10.1.1.3/32:
            hostname: talos-k8s-mixed-03
          10.1.1.4/32:
            hostname: talos-k8s-mixed-04
        10.1.2.0/24:
          description: VM hosts OOBM
          10.1.2.1/32:
            hostname: proxmox-vm-host-01
        10.1.3.0/24:
          description: Power devices
          10.1.3.1/32:
            hostname: ups-01
          10.1.3.2/32:
            hostname: pdu-01
        10.1.4.0/24:
          description: Storage devices
          10.1.4.1/32:
            hostname: tape-library-01
        10.1.5.0/24:
          description: KVM consoles
          10.1.5.1/24:
            hostname: kvm-01
      10.2.0.0/16:
        description: Hosts
        vlan: 200
        gateway: 10.2.0.254/32
        10.2.0.0/24:
          description: Network devices
          10.2.0.0/25:
            description: OPNsense VMs
            10.2.0.1/32:
              hostname: opnsense-01
            10.2.0.2/32:
              hostname: opnsense-02
          10.2.0.254/32:
            description: OPNsense VIP
        10.2.1.0/24:
          description: Kubernetes hosts
          10.2.1.1/32:
            hostname: talos-k8s-mixed-01
          10.2.1.2/32:
            hostname: talos-k8s-mixed-02
          10.2.1.3/32:
            hostname: talos-k8s-mixed-03
          10.2.1.4/32:
            hostname: talos-k8s-mixed-04
        10.2.2.0/24:
          description: VM hosts
          10.2.2.1/32:
            hostname: proxmox-vm-host-01
        10.2.3.0/24:
          description: VMs
      10.3.0.0/16:
        description: Kubernetes
        vlan: 300
        gateway: 10.3.0.254/32
        10.3.0.0/24:
          description: Network devices
          10.3.0.254/32:
            description: OPNsense VIP
        10.3.1.0/24:
          description: Kubernetes hosts
          10.3.1.1/32:
            hostname: talos-k8s-mixed-01
          10.3.1.2/32:
            hostname: talos-k8s-mixed-02
          10.3.1.3/32:
            hostname: talos-k8s-mixed-03
          10.3.1.4/32:
            hostname: talos-k8s-mixed-04
      10.4.0.0/16:
        vlan: 400
        gateway: 10.4.0.254/32
        10.4.0.0/24:
          description: Network devices
          10.4.0.254/32:
            description: OPNsense VIP
      10.5.0.0/16:
        vlan: 500
        gateway: 10.5.0.254/32
        10.5.0.0/24:
          description: Network devices
          10.5.0.254/32:
            description: OPNsense VIP
      10.6.0.0/16:
        vlan: 600
        gateway: 10.6.0.254/32
        10.6.0.0/24:
          description: Network devices
          10.6.0.254/32:
            description: OPNsense VIP
    10.32.0.0/11:
      description: Kubernetes services
      10.32.0.0/16:
        description: Pod IPs
        vlan: 300
      10.33.0.0/16:
        description: Cluster IPs
        vlan: 300
      10.34.0.0/16:
        description: External/load balanced IPs
        vlan: 300
  192.168.11.0/24:
    description: XGS-PON subnet
